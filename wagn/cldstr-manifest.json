{
  "type"          : "app",
  "bizmodels"     : [ 
    {
      "model"      : "subscription",
      "fee"        : "4.99 USD",
      "period"     : "1 month",
      "evalperiod" : "1 month"
    }
  ],
  "architectures" : [ "arch_nwsa_1dbm" ],

  "info" : {
    "name"            : "Wagn",
    "tagline"         : "how pioneers roll",
    "developer"       : "wagn.org",
    "upstreamversion" : "1.9.0",
    "cldstrversion"   : "0.%{now.identifier}",
    "licenses"        : [ "gplv2" ]
  },

  "package"       : { 
    "maintainer"      : "wagn.org", 
    "packagebasename" : "wagn",
  }, 

  "roles" : {
    "ws" : {
      "defaultcontext" : "/wagn",
      "depends" : [
        "cldstr+cldstr.com+passenger+ss",
        "cldstr+cldstr.com+rubygems+ss",
        "cldstr+cldstr.com+postfix+ss",
        "cldstr+cldstr.com+memcached+ws",
        "libmysql-ruby",
        "libmysqlclient-dev",
        "imagemagick",
        "libmagickwand-dev",
        "libapache2-mod-passenger",
        "libapache2-mod-xsendfile"
      ],
      "robotstxt" : {
        "disallow" : [
          "/card/",
          "/admin/",
          "/account/",
          "/*?*"
        ]
      },
      "apache2modules" : [
        "passenger",
        "expires",
        "xsendfile",
        "headers"
      ],
      "files" : [
        {
          "uname" : "www-data",
          "gname" : "www-data",
          "mode"  : "0755",
          "paths" : [ 
            "/var/log/cldstr+wagn.org+wagn+ws",
            "web/script/rails",
            "bin/migrate.rb",
            "web/db/schema.rb"
          ]
        },
        {
          "mode"  : "0666",
          "paths" : [  "web/tmp/restart.txt" ]
        }        
      ],
      "appconfigitems" : [
        {
          "type"         : "file",
          "name"         : ".htaccess",
          "template"     : "tmpl/htaccess.tmpl",
          "templatelang" : "varsubst"
        },
        {
          "type"         : "directory",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}"
        },
        {
          "type"         : "directory",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/.bundle"
        },
        {
          "type"         : "directory",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/mods"
        },
        {
          "type"         : "directory",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/config"
        },
        {
          "type"         : "file",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/config/database.yml",
          "template"     : "tmpl/database.yml.tmpl",
          "templatelang" : "varsubst"
		    },
        {
          "type"         : "file",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/config/application.rb",
          "template"     : "tmpl/application.rb.tmpl",
          "templatelang" : "varsubst"
		    },
        {
          "type"         : "file",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/config/boot.rb",
          "template"     : "tmpl/boot.rb"
		    },
		    {
          "type"         : "file",
          "uname"        : "www-data",
          "gname"        : "www-data",
          "mode"         : "0755",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/config.ru",
          "template"     : "tmpl/config.ru"
        },
        {
          "type"         : "file",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/Gemfile",
          "template"     : "tmpl/Gemfile"
        },
        {
          "type"         : "file",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/.bundle/config",
          "template"     : "tmpl/bundleconfig"
        },
        {
          "type"         : "file",
          "uname"        : "www-data",
          "gname"        : "www-data",
          "mode"         : "0755",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/Gemfile.lock",
          "template"     : "tmpl/Gemfile.lock"
        },
        {
          "type"         : "file",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/Rakefile",
          "template"     : "tmpl/Rakefile"
        },
		    
        {
          "type"         : "file",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/config/environment.rb",
          "template"     : "tmpl/environment.rb"
		    },
        
        {
          "type"         : "directory",
          "uname"        : "www-data",
          "gname"        : "www-data",
          "mode"         : "0755",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/files",
          "retention"    : "backup",
          "retentionbucket" : "uploads"
        },
        {
          "type"         : "directory",
          "uname"        : "www-data",
          "gname"        : "www-data",
          "mode"         : "0755",
          "name"         : "/var/cldstr/wagn.org/wagn/ws/${appconfig.appconfigid}/tmp",
        },
        {
          "type"         : "file",
          "uname"        : "www-data",
          "gname"        : "www-data",
          "mode"         : "0666",
          "name"         : "/var/log/cldstr+wagn.org+wagn+ws/${appconfig.appconfigid}.log"
        },
        {
          "type"         : "symlink",
          "target"       : "/usr/cldstr/wagn.org/wagn/ws/web/public/$4",
          "names"        : [
            "assets",
            "assets2bpacked",
            "files",
            "404.html",
            "500.html",
            "favicon.ico"
          ]
        }
      ],
      "postappconfiginst" : {
        "type" : "perlscript",
        "name" : "bin/migrate.pl"
      }
    },
    "ctrl" : {
      "appconfigitems" : [
        {
          "type"            : "mysql-database",
          "name"            : "maindb",
          "create"          : "/usr/cldstr/wagn.org/wagn/ctrl/tmpl/bootstrap.sql",
          "retention"       : "backup",
          "retentionbucket" : "db",
          "privileges"      : "create, alter, drop, index, select, insert, update, delete"
        }
      ]
    }
  }
}
