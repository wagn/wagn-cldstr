#!/bin/sh

MANIFEST_DIR=$CLDHOME/apps/wagn-cldstr/wagn
WAGN_DIR=$MANIFEST_DIR/files-ws/web

DISTRO=$1
WAGN_BRANCH=$2

if [ -z $DISTRO ]; then
  echo "usage: push <distro>"
  exit 1
fi

if [ -z $WAGN_BRANCH ]; then
  WAGN_BRANCH=develop
fi

cd $MANIFEST_DIR

case $DISTRO in
'red')
  git checkout develop
  git commit -a -m 'red commit sweep'
  update_cldstr_wagn
;;
'yellow')
  git checkout master
  git merge --no-edit develop
;;
'green')
  git checkout stable
  git merge --no-edit master
;;
*)  
  echo "unknown distro: $DISTRO";
  exit 1 ;;
esac

build_mods $DISTRO
cd $MANIFEST_DIR
cloud_build $DISTRO
cloud_update dev



case $DISTRO in
'red')
  
  update_cldstr_wagn

;;
'yellow')
  git merge --no-edit develop
  build_mods $DISTRO
  cd $MANIFEST_DIR
  cloud_build $DISTRO
  git checkout develop
;;
'green')
  
  build_mods $DISTRO
  cd $MANIFEST_DIR
  cloud_build $DISTRO
  git checkout develop
;;
esac


git push

 

